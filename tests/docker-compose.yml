version: '3.1'

services:

  varnish:
    image: varnish:6.0
    restart: always
    ports:
      - "80:6081"
      - "6085:6085"

  nri-varnish:
    build:
      dockerfile: tests/nri-varnish/Dockerfile
      context: ../
    #image: golang:1.16
    container_name: nri_varnish
    #working_dir: /code
    environment:
      INSTANCE_NAME: "demo"
      PARAMS_CONFIG_FILE: /code/tests/nri-varnish/varnish.params
    depends_on:
      - varnish
    volumes:
      - ../:/code
    entrypoint: go run /code/cmd/nri-varnish/main.go